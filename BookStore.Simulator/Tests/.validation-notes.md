# Contract Test Format Notes

## SimV1 Schema Requirements

All contract tests must follow the SimV1 schema format defined in `BookStore.Simulator/Documentation/API-SIMULATOR-SCHEMA.json`.

### Key Format Rules:

1. **Schema Declaration**

   ```yaml
   schema: SimV1
   name: test-suite-name
   ```

2. **Connections Section**

   ```yaml
   connections:
     - name: connection-name
       endpoint: http://localhost:port
       listen: false
   ```

3. **Services (Tests)**
   - Each test is a "service" with steps
   - Steps alternate between `Out` (send) and `In` (receive)

4. **Out Step Format**

   ```yaml
   - direction: Out
     name: stepName
     to: connection-name
     message:
       method: GET/POST/PUT/DELETE
       headers:
         - key: HeaderName
           value: HeaderValue
       payload: |-
         JSON or text content
     insert:
       - type: Path
         value: /api/path
   ```

5. **In Step Format**

   ```yaml
   - direction: In
     name: stepName
     verify:
       - property: StatusCode
         value: 200 OK
       - jsonPath: field.name
         value: expected-value
       - jsonPath: other.field
         exists: true
   ```

6. **Common Mistakes to Avoid:**
   - ❌ Using `uri:` instead of `insert` with `type: Path`
   - ❌ Using `validate` instead of `verify`
   - ❌ Using `statusCode:` instead of `property: StatusCode`
   - ❌ Missing `to:` connection reference on Out steps
   - ❌ Forgetting `schema: SimV1` at the top

## Running Contract Tests

Contract tests are executed through the API Simulator UI:

1. Open http://localhost:28880/ui/
2. Navigate to Contract Tests section
3. Select test file
4. Run tests and view results

## Reference Files

- Schema: `BookStore.Simulator/Documentation/API-SIMULATOR-SCHEMA.json`
- Examples: `/Users/j.stennett/TAIS/hub-service/Tricentis.AI.Hub.EventSimulator/Simulations/contract-tests/`
